{"version":3,"file":"abp-ng.account.core.mjs","sources":["../../../../packages/account-core/src/lib/auth-wrapper.service.ts","../../../../packages/account-core/src/lib/tenant-box.service.ts","../../../../packages/account-core/src/public-api.ts","../../../../packages/account-core/src/abp-ng.account.core.ts"],"sourcesContent":["import { Injectable, Injector } from '@angular/core';\r\nimport { Observable } from 'rxjs';\r\nimport { map } from 'rxjs/operators';\r\nimport { ActivatedRoute } from '@angular/router';\r\nimport { ConfigStateService, MultiTenancyService } from '@abp/ng.core';\r\n\r\n@Injectable()\r\nexport class AuthWrapperService {\r\n  isMultiTenancyEnabled$ = this.configState.getDeep$('multiTenancy.isEnabled');\r\n\r\n  get enableLocalLogin$(): Observable<boolean> {\r\n    return this.configState\r\n      .getSetting$('Abp.Account.EnableLocalLogin')\r\n      .pipe(map(value => value?.toLowerCase() !== 'false'));\r\n  }\r\n\r\n  tenantBoxKey = 'Account.TenantBoxComponent';\r\n  route: ActivatedRoute;\r\n\r\n  get isTenantBoxVisibleForCurrentRoute() {\r\n    return this.getMostInnerChild().data.tenantBoxVisible ?? true;\r\n  }\r\n\r\n  get isTenantBoxVisible() {\r\n    return this.isTenantBoxVisibleForCurrentRoute && this.multiTenancy.isTenantBoxVisible;\r\n  }\r\n\r\n  constructor(\r\n    public readonly multiTenancy: MultiTenancyService,\r\n    private configState: ConfigStateService,\r\n    injector: Injector,\r\n  ) {\r\n    this.route = injector.get(ActivatedRoute);\r\n  }\r\n\r\n  private getMostInnerChild() {\r\n    let child = this.route.snapshot;\r\n    let depth = 0;\r\n    const depthLimit = 10;\r\n    while (child.firstChild && depth < depthLimit) {\r\n      child = child.firstChild;\r\n      depth++;\r\n    }\r\n    return child;\r\n  }\r\n}\r\n","import {\r\n  AbpTenantService,\r\n  ConfigStateService,\r\n  CurrentTenantDto,\r\n  SessionStateService,\r\n} from '@abp/ng.core';\r\nimport { ToasterService } from '@abp/ng.theme.shared';\r\nimport { Injectable } from '@angular/core';\r\nimport { finalize } from 'rxjs/operators';\r\n\r\n@Injectable()\r\nexport class TenantBoxService {\r\n  currentTenant$ = this.sessionState.getTenant$();\r\n\r\n  name: string;\r\n\r\n  isModalVisible: boolean;\r\n\r\n  modalBusy: boolean;\r\n\r\n  constructor(\r\n    private toasterService: ToasterService,\r\n    private tenantService: AbpTenantService,\r\n    private sessionState: SessionStateService,\r\n    private configState: ConfigStateService,\r\n  ) {}\r\n\r\n  onSwitch() {\r\n    const tenant = this.sessionState.getTenant();\r\n    this.name = tenant?.name;\r\n    this.isModalVisible = true;\r\n  }\r\n\r\n  save() {\r\n    if (!this.name) {\r\n      this.setTenant(null);\r\n      this.isModalVisible = false;\r\n      return;\r\n    }\r\n\r\n    this.modalBusy = true;\r\n    this.tenantService\r\n      .findTenantByName(this.name, {})\r\n      .pipe(finalize(() => (this.modalBusy = false)))\r\n      .subscribe(({ success, tenantId: id, ...tenant }) => {\r\n        if (!success) {\r\n          this.showError();\r\n          return;\r\n        }\r\n\r\n        this.setTenant({ ...tenant, id, isAvailable: true });\r\n        this.isModalVisible = false;\r\n      });\r\n  }\r\n\r\n  private setTenant(tenant: CurrentTenantDto) {\r\n    this.sessionState.setTenant(tenant);\r\n    this.configState.refreshAppState();\r\n  }\r\n\r\n  private showError() {\r\n    this.toasterService.error('AbpUiMultiTenancy::GivenTenantIsNotAvailable', 'AbpUi::Error', {\r\n      messageLocalizationParams: [this.name],\r\n    });\r\n  }\r\n}\r\n","/*\r\n * Public API Surface of account-core\r\n */\r\n\r\nexport * from './lib/auth-wrapper.service';\r\nexport * from './lib/tenant-box.service';\r\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public-api';\n"],"names":[],"mappings":"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"}